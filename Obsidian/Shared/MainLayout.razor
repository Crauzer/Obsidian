@using Obsidian.Data;
@inherits LayoutComponentBase

<style>
    .main-content-vertical {
        height: 100%;
        margin-left: 75px !important;
        padding-top: 0px !important;
    }

    .mud-drawer {
        background: rgb(113,43,54);
        background: linear-gradient(180deg, rgba(113,43,54,1) 0%, rgba(143,41,57,1) 100%);
    }

    .logo-image {
        width: 50px;
        border-radius: 25%;
        transition: box-shadow 250ms, width 100ms;
    }

        .logo-image:hover {
            width: 51px;
            box-shadow: 0px 0px 8px rgba(0,0,0,4);
        }
</style>

<MudThemeProvider IsDarkMode Theme="AppTheme.Theme" />
<MudDialogProvider />
<MudSnackbarProvider />
<HashtableProvider OnLoadingStart="OnHashtableLoadingStart" OnLoadingFinished="OnHashtableLoadingFinished" />

<MudLayout>
    <MudDrawer Open
               Style="width: 75px;"
               Elevation="4">
        <MudStack Class="py-2" Style="height: 100%"
                  AlignItems="AlignItems.Center">
            <MudImage Class="logo-image"
                      Elevation="6"
                      ObjectFit="ObjectFit.ScaleDown"
                      Src="images/obsidian_logonew_256.png" Alt="Obsidian logo" />
            <MudSpacer />
            <MudStack AlignItems="AlignItems.Center">
                <MudTooltip Text="Settings" Color="Color.Dark" Placement="Placement.Right">
                    <MudIconButton Icon="@Icons.Material.TwoTone.Settings" Size="Size.Large"
                                   OnClick="OpenSettings" />
                </MudTooltip>
                <MudTooltip Text="Submit Bug Report" Color="Color.Dark" Placement="Placement.Right">
                    <MudIconButton Icon="@CustomIcons.Material.Alert" Color="Color.Inherit" Size="Size.Medium"
                                   OnClick="SubmitBugReport" />
                </MudTooltip>
                <MudTooltip Text="Go to GitHub" Color="Color.Dark" Placement="Placement.Right">
                    <MudIconButton Icon="@Icons.Custom.Brands.GitHub" Color="Color.Inherit" Size="Size.Medium"
                                   OnClick="GoToGithub" />
                </MudTooltip>
            </MudStack>
        </MudStack>
    </MudDrawer>
    <MudMainContent Class="main-content-vertical">
        @Body
    </MudMainContent>
    <MudOverlay DarkBackground Visible="_isLoadingHashtable" ZIndex="9999">
        <MudStack AlignItems="AlignItems.Center">
            <MudProgressCircular Indeterminate Color="Color.Primary" Size="Size.Large" />
            <MudText Typo="Typo.h5">Syncing hashtables from CDragon...</MudText>
        </MudStack>
    </MudOverlay>
</MudLayout>

@code {
    [Inject] public IDialogService DialogService { get; set; }
    [Inject] public IJSRuntime JS { get; set; }

    private bool _isLoadingHashtable;

    private void OnHashtableLoadingStart()
    {
        this._isLoadingHashtable = true;
    }

    private void OnHashtableLoadingFinished()
    {
        this._isLoadingHashtable = false;
    }

    private void OpenSettings()
    {
        this.DialogService.Show<SettingsDialog>();
    }

    private async Task SubmitBugReport()
    {
        await this.JS.InvokeVoidAsync("useCmd", @"explorer ""https://github.com/Crauzer/Obsidian/issues/new?assignees=&labels=bug%2C+triage&template=bug_report.md&title=%5BBUG%5D+%2A%2ABug+report+title+here%2A%2A""");
    }

    private async Task GoToGithub()
    {
        await this.JS.InvokeVoidAsync("useCmd", @"explorer ""https://github.com/Crauzer/Obsidian""");
    }
}
