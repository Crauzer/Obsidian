@using Obsidian.Data;
@inherits LayoutComponentBase

<MudThemeProvider IsDarkMode Theme="Theme" />
<MudDialogProvider />
<MudSnackbarProvider />
<HashtableProvider OnLoadingStart="OnHashtableLoadingStart" OnLoadingFinished="OnHashtableLoadingFinished" />

<MudLayout>
    <MudAppBar Elevation="1">
        <MudImage Style="border-radius: 8px"
                  Elevation="6"
                  ObjectFit="ObjectFit.ScaleDown" Height="50"
                  Src="images/obsidian_logonew_256.png" Alt="Obsidian logo" />
        <MudText Typo="Typo.h5" Class="ml-3" Style="text-shadow: 1px 1px 6px black">Obsidian</MudText>
        <MudSpacer />
        <MudStack Row Spacing="2">
            <MudTooltip Text="Settings" Color="Color.Dark">
                <MudIconButton Icon="@Icons.Material.TwoTone.Settings" Color="Color.Dark" Size="Size.Large"
                               Variant="Variant.Filled" />
            </MudTooltip>
            <MudTooltip Text="Go to GitHub" Color="Color.Dark">
                <MudIconButton Icon="@Icons.Custom.Brands.GitHub" Color="Color.Dark" Size="Size.Large"
                               Variant="Variant.Filled"
                               Href="https://github.com/Crauzer/Obsidian" Target="_blank" />
            </MudTooltip>
        </MudStack>
    </MudAppBar>
    <MudMainContent Style="height: 100%">
        @Body
    </MudMainContent>
    <MudOverlay DarkBackground Visible="_isLoadingHashtable" ZIndex="9999">
        <MudStack AlignItems="AlignItems.Center">
            <MudProgressCircular Indeterminate Color="Color.Primary" Size="Size.Large" />
            <MudText Typo="Typo.h5">Syncing hashtables from CDragon...</MudText>
        </MudStack>
    </MudOverlay>
</MudLayout>

@code {
    private bool _isLoadingHashtable;

    private void OnHashtableLoadingStart()
    {
        this._isLoadingHashtable = true;
    }

    private void OnHashtableLoadingFinished()
    {
        this._isLoadingHashtable = false;
    }

    MudTheme Theme = new()
        {
            Palette = new Palette()
            {
                Primary = Colors.Red.Accent2,
                AppbarBackground = Colors.Red.Darken1
            },
            PaletteDark = new PaletteDark()
            {
                Primary = Colors.Red.Accent2,
                AppbarBackground = Colors.Red.Darken1
            },
            LayoutProperties = new LayoutProperties()
            {
                DefaultBorderRadius = "8px"
            },
            Typography = new Typography()
            {
                Default = new Default()
                {
                    FontFamily = new[] { "Fira Sans" }
                }
            }
        };
}
